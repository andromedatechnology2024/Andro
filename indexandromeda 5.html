<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dhaka Traffic Control</title>
  <style>
    /* Existing styles here */

    /* New styles for server connection input */
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 2px solid #1d4ed8;
      border-radius: 5px;
      font-size: 14px;
    }

    button {
      background-color: #1d4ed8;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #2563eb;
    }

    #connectionStatus {
      font-size: 18px;
      margin-top: 10px;
      color: #1d4ed8;
    }
  
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9fafb;
      color: #333;
      text-align: center;
      transition: background-color 0.3s;
    }

    h1 {
      color: #1d4ed8;
      margin-top: 20px;
      font-size: 2.5em;
      font-weight: bold;
    }

    .container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px;
    }

    .controls {
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 280px;
    }

    .dot {
      position: absolute;
      width: 20px;
      height: 20px;
      background-color: #e11d48;
      border-radius: 50%;
      pointer-events: none;
      transform: translate(-50%, -50%);
    }

    canvas {
      background-color: #ffffff;
      border: 2px solid #1d4ed8;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    input[type="range"], input[type="color"] {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border: 2px solid #1d4ed8;
      border-radius: 5px;
      background-color: #fff;
    }

    button {
      background-color: #1d4ed8;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #2563eb;
    }

    .status {
      font-size: 18px;
      margin-top: 10px;
      color: #1d4ed8;
    }

    #fine {
      color: #16a34a;
      font-weight: bold;
    }

    .image-upload {
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
    }

    .footer {
      font-size: 14px;
      color: #555;
      margin-top: 20px;
    }

    .footer i {
      font-style: italic;
    }

    /* Hamburger Menu */
    .hamburger-menu {
      display: block;
      cursor: pointer;
      position: absolute;
      top: 750px;
      left: 20px;
      z-index: 1000;
    }

    .hamburger-menu div {
      width: 30px;
      height: 3px;
      background-color: #1d4ed8;
      margin: 5px;
      transition: transform 0.3s;
    }

    .menu-items {
      display: none;
      flex-direction: column;
      background-color: #fff;
      position: absolute;
      top: 60px;
      left: 20px;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 999;
    }

    .menu-items.active {
      display: flex;
    }

    .hamburger-menu.active div:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger-menu.active div:nth-child(2) {
      opacity: 0;
    }

    .hamburger-menu.active div:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }

    /* Adding a smooth transition for background color */
    .transition-background {
      transition: background-color 0.5s ease;
    }
  </style>
</head>
<body>
  <h1>Dhaka Traffic Control</h1>

  <!-- Hamburger Menu -->
  <div class="hamburger-menu" onclick="toggleMenu()">
    <div></div>
    <div></div>
    <div></div>
  </div>

  <div class="menu-items" id="menuItems">
    <!-- Server Connection Section inside Menu -->
    <div class="controls">
      <label for="serverAddress">সার্ভার ঠিকানা লিখুন:</label>
      <input type="text" id="serverAddress" placeholder="https://your-server-address.com/api">
      <button onclick="connectToServer()">সংযোগ করুন</button>
      <div id="connectionStatus" class="status"></div>
    </div>

    <!-- Drawing Tools Menu Bar -->
    <div class="controls">
      <label for="color">Choose Line Color:</label>
      <input type="color" id="color" value="#1d4ed8">
      <label for="moveDot">Move Dot:</label>
      <input type="range" id="moveDot" min="0" max="100" value="0" step="1">
      <button onclick="clearCanvas()">Clear Canvas</button>
    </div>
  </div>

  <div class="container">
    <!-- Canvas Section -->
    <canvas id="canvas" width="400" height="400"></canvas>
  </div>

  <div class="image-upload">
    <input type="file" id="backgroundImage" accept="image/*">
    <input type="range" id="imageSizeSlider" min="10" max="100" value="100">
    <label for="imageSizeSlider">Resize Image (%)</label>
  </div>

  <!-- Timer and Fine Section -->
  <div id="timer" class="status">Timer: 30s</div>
  <div id="fine" class="status">Fine: $0</div>
  <div id="stopwatch" class="status">Stopwatch: 0s</div>

  <!-- Dot Movement -->
  <div class="dot" id="dot"></div>

  <!-- Footer -->
  <div class="footer">
    <i>Team Work of Team Andromeda<br>Developed by Md Tanvir Rahman<br>Hardware by Takwa and Wasi</i>
  </div>

  <script>
    // JavaScript functions for server connection and interaction
    function connectToServer() {
      const serverAddress = document.getElementById('serverAddress').value;
      const connectionStatus = document.getElementById('connectionStatus');
      
      if (!serverAddress) {
        connectionStatus.textContent = "দয়া করে একটি বৈধ সার্ভার ঠিকানা লিখুন।";
        connectionStatus.style.color = "red";
        return;
      }

      fetch(serverAddress)
        .then(response => response.json())
        .then(data => {
          console.log("সার্ভার রেসপন্স:", data);
          connectionStatus.textContent = "সার্ভারের সাথে সফলভাবে সংযোগ করা হয়েছে!";
          connectionStatus.style.color = "green";
        })
        .catch(error => {
          console.error("সার্ভারের সাথে সংযোগ করতে সমস্যা:", error);
          connectionStatus.textContent = "সার্ভারের সাথে সংযোগ করতে ব্যর্থ।";
          connectionStatus.style.color = "red";
        });
    }
    
    // Existing JavaScript functions for the rest of the interactions like canvas, timer, etc.
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const dot = document.getElementById('dot');
    const moveDot = document.getElementById('moveDot');
    const timerDisplay = document.getElementById('timer');
    const fineDisplay = document.getElementById('fine');
    const stopwatchDisplay = document.getElementById('stopwatch');
    const colorPicker = document.getElementById('color');
    const backgroundImageInput = document.getElementById('backgroundImage');
    const imageSizeSlider = document.getElementById('imageSizeSlider');
    const menuItems = document.getElementById('menuItems');
    const hamburgerMenu = document.querySelector('.hamburger-menu');

    let drawing = false;
    let points = [];
    let timer = null;
    let stopwatch = null;
    let timerSeconds = 30;
    let stopwatchSeconds = 0;
    let fineAmount = 0;
    let fineInterval = null;

    let backgroundImage = new Image();
    let backgroundImageWidth = 800;
    let backgroundImageHeight = 400;

    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDrawing);

    backgroundImageInput.addEventListener('change', loadImage);
    imageSizeSlider.addEventListener('input', resizeImage);

    function toggleMenu() {
      menuItems.classList.toggle('active');
      hamburgerMenu.classList.toggle('active');
    }

    function loadImage(e) {
      const reader = new FileReader();
      reader.onload = function(event) {
        backgroundImage.src = event.target.result;
        backgroundImage.onload = function() {
          drawBackgroundImage();
        };
      };
      reader.readAsDataURL(e.target.files[0]);
    }

    function resizeImage() {
      const scale = imageSizeSlider.value / 100;
      backgroundImageWidth = 800 * scale;
      backgroundImageHeight = 800 * scale;
      drawBackgroundImage();
    }

    function drawBackgroundImage() {
      ctx.clearRect(0, 0, canvas.width, canvas.height); // Keep the canvas clear before redrawing
      ctx.drawImage(backgroundImage, 0, 0, backgroundImageWidth, backgroundImageHeight);
      redraw();
    }

    function startDrawing(e) {
      e.preventDefault();
      drawing = true;
      const touch = e.touches[0];
      addPoint(touch.clientX, touch.clientY, colorPicker.value);
      updateDotPosition(0);
      redraw();
    }

    function draw(e) {
      if (!drawing) return;
      e.preventDefault();
      const touch = e.touches[0];
      addPoint(touch.clientX, touch.clientY, colorPicker.value);
      redraw();
    }

    function stopDrawing() {
      drawing = false;
    }

    function addPoint(x, y, color) {
      const adjustedX = x - canvas.offsetLeft;
      const adjustedY = y - canvas.offsetTop;
      points.push({ x: adjustedX, y: adjustedY, color });
    }

    function redraw() {
      ctx.lineWidth = 3;
      for (let i = 0; i < points.length - 1; i++) {
        ctx.strokeStyle = points[i].color;
        ctx.beginPath();
        ctx.moveTo(points[i].x, points[i].y);
        ctx.lineTo(points[i + 1].x, points[i + 1].y);
        ctx.stroke();
      }
    }

    function clearCanvas() {
      points = [];
      moveDot.value = 0;
      resetTimer();
      resetStopwatch();
      dot.style.left = '-20px';
      dot.style.top = '-20px';
      fineAmount = 0;
      fineDisplay.innerText = "Fine: $0";
      drawBackgroundImage(); // Redraw the background image
    }

    moveDot.addEventListener('input', () => {
      if (points.length > 0) {
        const index = Math.floor((moveDot.value / 100) * (points.length - 1));
        moveDotTo(points[index]);
        checkForBlackColor(points[index]);
      }
    });

    function moveDotTo(point) {
      dot.style.left = `${point.x + canvas.offsetLeft}px`;
      dot.style.top = `${point.y + canvas.offsetTop}px`;
    }

    function checkForBlackColor(point) {
      const imageData = ctx.getImageData(point.x, point.y, 1, 1);
      const [r, g, b] = imageData.data;
      if (r === 0 && g === 0 && b === 0) {
        if (!timer) startTimer();
      } else {
        resetTimer();
      }
    }

    function startTimer() {
      timerSeconds = 30;
      timerDisplay.innerText = `Timer: ${timerSeconds}s`;
      timer = setInterval(() => {
        timerSeconds--;
        timerDisplay.innerText = `Timer: ${timerSeconds}s`;
        if (timerSeconds <= 0) {
          startFine();
          resetTimer();
        }
      }, 1000);
    }

    function resetTimer() {
      clearInterval(timer);
      timer = null;
      timerSeconds = 30;
      timerDisplay.innerText = "Timer: 30s";
    }

    function startFine() {
      fineAmount = 0;
      fineDisplay.innerText = `Fine: $${fineAmount}`;
      document.body.classList.add("transition-background");
      document.body.style.backgroundColor = "#ef4444"; // Red theme
      fineInterval = setInterval(() => {
        fineAmount += 1;
        fineDisplay.innerText = `Fine: $${fineAmount}`;
      }, 10000);

      startStopwatch();
    }

    function startStopwatch() {
      stopwatchSeconds = 0;
      stopwatchDisplay.innerText = `Stopwatch: ${stopwatchSeconds}s`;
      stopwatch = setInterval(() => {
        stopwatchSeconds++;
        stopwatchDisplay.innerText = `Stopwatch: ${stopwatchSeconds}s`;
      }, 1000);
    }

    function resetStopwatch() {
      clearInterval(stopwatch);
      stopwatch = null;
      stopwatchSeconds = 0;
      stopwatchDisplay.innerText = "Stopwatch: 0s";
    }
  </script>
</body>
</html>